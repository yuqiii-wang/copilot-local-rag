<!DOCTYPE html>
<html>
<head>

<style>
    body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; color: #172b4d; }
    .issue-header { margin-bottom: 20px; border-bottom: 2px solid #dfe1e6; padding-bottom: 10px; }
    .issue-key { color: #0052cc; font-size: 14px; margin-bottom: 5px; }
    .issue-summary { font-size: 24px; font-weight: 500; margin: 0; }
    .meta-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; background: #f4f5f7; padding: 15px; border-radius: 5px; }
    .meta-item { display: flex; flex-direction: column; }
    .meta-label { font-size: 12px; font-weight: bold; color: #5e6c84; text-transform: uppercase; }
    .meta-value { font-size: 14px; color: #172b4d; }
    h2 { font-size: 18px; border-bottom: 1px solid #dfe1e6; padding-bottom: 5px; margin-top: 30px; }
    code { background-color: #f4f5f7; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
</style>

<title>[BUG-209] Realized PnL calculation incorrect on partial sells</title>
</head>
<body>
<div class="issue-header">
<div class="issue-key"><a href="#">BUG-209</a></div>
<h1 class="issue-summary">Realized PnL calculation incorrect on partial sells</h1>
</div>
<div class="meta-grid">
<div class="meta-item"><span class="meta-label">Type</span><span class="meta-value">Bug</span></div>
<div class="meta-item"><span class="meta-label">Status</span><span class="meta-value">Open</span></div>
<div class="meta-item"><span class="meta-label">Priority</span><span class="meta-value">Medium</span></div>
</div>
<div class="description">
<h2>Description</h2>
<p>The current logic in `Position.java` simplifies PnL calculation.</p>
<p>It assumes a simple `(TradePrice - AvgCost) * Qty`.</p>
<p>However, if the position flips from Long to Short in a single trade, the Logic might break or be inaccurate.</p>
<br>
<h2>Steps to Reproduce</h2>
<p>1. Buy 100 @ 10.</p>
<p>2. Sell 200 @ 12.</p>
<p>3. Result should be: Realized PnL on 100, and new Short Position of 100.</p>
<p>4. Current code might just reduce quantity to -100 and calc PnL on 200, which is weird if cost basis changes.</p>
<br>
<h2>Code Reference</h2>
<p>backend/services/knowledge_graph/dummy_dataset/dummy_trading_sys_java/src/com/trading/dummy/model/Position.java</p>
<br>
<h2>Impact</h2>
<p>Accounting is wrong for flip-flop trades.</p>
<br>
</div>
</body>
</html>